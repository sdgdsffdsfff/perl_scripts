# Define the objects we'll be using
vms = vm1
images = image1
nics = nic1

# Choose the main VM
main_vm = vm1

# Some preprocessor/postprocessor params
start_vm = yes
kill_vm = no
kill_vm_gracefully = yes
kill_unresponsive_vms = yes

# for cases needing the vm to be successfully created,
# set this to 'yes', otherwise set to 'no'.
vm_critical = yes

# Some default VM params
memory = 512
maxmem = 512
vcpus = 4
on_poweroff = "destroy"
on_reboot = "restart"
on_crash = "preserve"
uuid = "1efb30c3-86fd-9dd7-4934-9b72b6a833fc"
vnc = 1
vnclisten = 0.0.0.0
# Attributes of disk
image_dev = "xvda"
image_mode = "w"
# Attributes of nic
nic_script = "vif-bridge"
nic_bridge = "xenbr0"
mac_prefix = "10:13:24:35:45:"
# nfs server
remote_images = 10.66.90.128:/vol/S1/xen/images
nfs_iso = 10.66.90.128:/vol/S1/iso/
# inaccuracy between actual size and from what can be gotten via xm list
max_mem_inaccuracy = 40
# Min memory size for Domain
min_safemem = 256
acpi = 1
apic = 1
pae = 1
localtime = 0
serial = "pty"

# Tests
variants:
    - shutdown_all:
        type = shutdown_all
        vms = ''
        parallel = no
    - image_copy:
        type = image_copy
        vms = ''
        parallel = no
    - xm_info:
        type = xm_info
        vms = ''
        parallel = no
    - xm_dmesg:
        type = xm_dmesg
        vms = ''
        parallel = no
    - xm_log:
        type = xm_log
        vms = ''
        parallel = no
    - xm_list:
        type = xm_list
    - xm_help:
        type = xm_help
        vms = ''
        parallel = no
    - sched_credit:
        type = sched_credit
    - audio_test:
        type = audio
    - restart_xend:
        type = restart_xend

    - VCPU_Management:
        variants:
            - vcpu_list:
                type = vcpu_list
            - vcpu_set:
                type = vcpu_set
                tcms_id = 75157
            - vcpu_pin:
                type = vcpu_pin
                tcms_id = 75160
            - vcpu_boot_pin:
                type = vcpu_boot_pin
                cpus = 0
                tcms_id = 75159

    - Balloon:
        # Fail if the difference of mem size between "xm list" and "free -m" is higher than 10%
        mem_threshold = 10
        variants:
            - mem_size:
                type = memsize
            - mem_set:
                type = memset
                restart_vm = yes
                kill_vm = yes
                kill_vm_gracefully = yes
                tcms_id = 74928
                variants:
                    - with_maxmem:
                    - without_maxmem:
                        maxmem ?-
            - mem_max:
                type = memmax
                memory = 512
                maxmem = 1024
                restart_vm = yes
                kill_vm = yes
                kill_vm_gracefully = yes
                tcms_id = 75072
    - Qcow:
        variants:
            - img2qcow:
                type = qcow
                start_vm = no
                cmd = img2qcow
            - qcow2raw:
                type = qcow
                start_vm = no
                cmd = qcow2raw
            - format_probe:
                type = boot
                pre_command = "scripts/set-format-probe.sh yes"
                tcms_id = 75109
            - format_set:
                type = boot
                pre_command = "scripts/set-format-probe.sh no"
            - format_guess:
                type = boot
                restart_vm = yes
                kill_vm = yes
                vm_critical = no
                # cover all the cases in this test
                variants:
                    - file:
                        backend = file
                    - tap_aio:
                        backend = tap:aio
                    - tap_qcow:
                        backend = tap:qcow
                variants:
                    - probe_off:
                        pre_command = "scripts/set-format-probe.sh no"
                    - probe_on:
                        pre_command = "scripts/set-format-probe.sh yes"

    - Network_Device_Model:
        variants:
            - network_list:
                type = network_list
                tcms_id = 75030, 75031, 75032, 75035
            - network_attach:
                type = network_attach_detach
                tcms_id = 75042
            - network_detach:
                type = network_attach_detach
                need_test_detach = yes
                tcms_id = 75042
            - network_default_value:
                type = boot
                nic_type ?-
                nic_model ?-
                tcms_id = 75039

    - Migration:
        variants:
            - migration:
                type = migration
                mig_timeout = 3600
                migration_test_command = uname -r
            - save_vm:
                type = save_restore
                tcms_id = 75021
            - restore_vm:
                type = save_restore
                need_restore = yes
                tcms_id = 75021
            - ping_pong_migration:
                type = ping_pong_migration
                mig_timeout = 3600
                migration_test_command = uname -r
                host_username = root
                host_password = redhat
                host_shell_prompt = "^\[.*\][\#\$]\s*$"
                host_shell_port = 22
                pq_migration_iterations = 5
                tcms_id = 75005, 75014, 75020

    - PV_Drivers:
        # Add another disk
        images += " image2"
        image_name_image2 = image_2nd
        image_dev_image2 = "xvdb"
        remove_image_image2 = yes
        force_create_image = yes
        force_create_image_image1 = no
        restart_vm = yes
        kill_vm = yes
        kill_vm_gracefully = yes
        variants:
            - block_list:
                type = block_list
            - block_attach:
                type = block_attach_detach
                boot_drive_image2 = no
                boot_drive_cdrom = no
                tcms_id = 74935
            - block_detach:
                type = block_attach_detach
                boot_drive_image2 = no
                boot_drive_cdrom = no
                need_detach_block = yes
                tcms_id = 74935
            - block_configure:
                type = block_configure
                boot_drive_image2 = no
                # Add a cdrom
                pre_command = "python scripts/check_iso.py"
                cdrom = ISO/Block-Test/boot.iso
                dev_cdrom = hdc
                prefix_cdrom = file
                cdrom_another = ISO/Block-Test/another-boot.iso
                cd_chk_cmd = xenstore-read /local/domain/0/backend/vbd/%s/5632/params |grep -o %s
            - xm_sysrq:
                type = xm_sysrq
                enable_sysrq_cmd = echo 1 > /proc/sys/kernel/sysrq

    - Time_Keeping:
        variants:
            - timedrift_with_load:
                type = timedrift
                # Set the load and rest durations
                load_duration = 120
                rest_duration = 20
                # Fail if the drift after load is higher than 50%
                drift_threshold = 50
                # Fail if the drift after the rest period is higher than 10%
                drift_threshold_after_rest = 10
            - timedrift_with_reboot:
                type = timedrift_with_reboot
                reboot_iterations = 2
                drift_threshold = 10
                drift_threshold_single = 3
            - timedrift_with_migration:
                type = timedrift_with_migration
                migration_iterations = 3
                drift_threshold = 10
                drift_threshold_single = 3

    - Guest_Dump_Core:
        core_file_chk_cmd = file %s/*%s* | grep "core file"
        core_file_del_cmd = rm -f %s/*%s*
        core_file_default_path = /var/lib/xen/dump
        kill_vm = yes
        variants:
            - dump_core_automatically:
                type = dump_core_auto
            - dump_core_manually:
                type = dump_core_manual
                tcms_id = 74988
    - hvmloader:
        variants:
            - pxeboot:
                type = "pxeboot"
                boot = "n"
                start_vm = "no"
            - check_smbios:
                type = "check_smbios"

    - cpuflags:
        variants:
            - check_cpuflags:
                type = "check_cpuflags"

    - Power_Management:
        variants:
            - acpi_check_on:
                type = acpi_check
                acpi = 1
                acpi_check_on_cmd = dmesg |grep -i "ACPI: RSDP"
            - acpi_check_off:
                type = acpi_check
                acpi = 0
                acpi_check_off_cmd = dmesg |grep -i "ACPI: Interpreter disabled."
            - guest_s4:
                type = guest_s4
                check_s4_support_cmd = grep -q disk /sys/power/state
                test_s4_cmd = "cd /tmp; nohup tcpdump -q -t ip host localhost"
                check_s4_cmd = pgrep tcpdump
                set_s4_cmd = echo disk > /sys/power/state
                kill_test_s4_cmd = pkill tcpdump
                # due to bug 627565
                vcpus = 1

    - Domain_Life_Cycle:
        variants:
            - boot:
                type = boot
                kill_vm_on_error = yes
            - reboot:
                type = boot
                reboot_method = shell
                kill_vm_on_error = yes
                tcms_id = 74980
            - pause_vm:
                type = pause_unpause
                tcms_id = 74978
            - unpause_vm:
                type = pause_unpause
                need_test_unpause = yes
                tcms_id = 74985
            - xm_shutdown:
                type = xm_shutdown
                tcms_id = 74982
                variants:
                  - xm_shutdown_noop:
                    check = yes
                  - xm_shutdown_w:
                    options = "-w"
                    check = yes
                  - xm_shutdown_R:
                    options = "-R"
                    relogin = yes
                  - xm_shutdown_H:
                    options = "-H"
                    check = yes
                  - xm_shutdown_a:
                    options = "-a"
                    check = yes
            - xm_destroy:
                type = xm_destroy
                tcms_id = 74972
            - shutdown_options:
                type = shutdown_options
                # we need to destroy the vm after each test case.
                # the restart or preserve values could confuse the preprocess script
                # and cause strange errors.
                kill_vm = yes
                kill_vm_gracefully = no
                variants:
                  - on_poweroff:
                    option = on_poweroff
                  - on_reboot:
                    option = on_reboot
                  - on_crash:
                    option = on_crash
                variants:
                  - destroy:
                    on_poweroff = destroy
                    on_reboot = destroy
                    on_crash = destroy
                  - restart:
                    on_poweroff = restart
                    on_reboot = restart
                    on_crash = restart
                  - preserve:
                    on_poweroff = preserve
                    on_reboot = preserve
                    on_crash = preserve
                  - rename_restart:
                    on_poweroff = rename-restart
                    on_reboot = rename-restart
                    on_crash = rename-restart
            - xm_domid:
                type = xm_domid
                tcms_id = 74973
            - xm_domname:
                type = xm_domname
                tcms_id = 74974
            - xm_uptime:
                type = xm_uptime
                uptime_inaccuracy = 20
            - xm_rename:
                type = xm_rename
                new_domain_name1 = "vm1_1"
                new_domain_name2 = "vm1_2"
                tcms_id = 74981
            - pv_prescript:
                type = pv_preinstall
                vms = ''
                parallel = no
                tcms_id = 74977
            - install:
                type = install
                kill_vm_on_error = yes
                kill_vm_on_error = yes
                force_create_image = yes
                kill_vm = yes
                kill_vm_gracefully = yes
                install_timeout = 6000

            - hvm_unattended_install:
                type = hvm_unattended_install
                kill_vm_on_error = yes
                force_create_image = yes
                kill_vm = yes
                kill_vm_gracefully = yes
                install_timeout = 3000
                tcms_id = 74975
            - pv_unattended_install:
                type = pv_unattended_install
                kill_vm_on_error = yes
                force_create_image = yes
                kill_vm = yes
                kill_vm_gracefully = yes
                install_timeout = 6000
                post_command = "python scripts/pv_postinstall.py"
                post_command_noncritical = yes
                tcms_id = 74977

    - Xendomains:
        type = xendomains
        start_vm = no
        kill_vm = no
        variants:
            - start:
                cmd = start
            - stop: start
                cmd = stop
            - save:
                cmd = save
            - restore: save
                cmd = restore
            - status:
                cmd = status
            - restart:
                cmd = restart
            - restore_fail:
                cmd = restore_fail

    - autotest
        type = autotest
        test_timeout = 720
        test_control_file = control
        kill_vm_on_error = yes
        variants:
            - dbench:
                test_name = dbench
                test_control_file = dbench.control
                profilers += "iostat sar "
            - bonnie:
                test_name = bonnie
                test_timeout = 3600
                test_control_file = bonnie.control
            - iozone:
                test_name = iozone
                test_timeout = 5400
                test_control_file = iozone.control
                profilers += "sar iostat "
    - autoit:
        type = autoit
        test_timeout = 1800
        autoit_binary="C:\AutoIt3\AutoIt3.exe"
        download = no
        download_cmd = "git clone"
        rsc_server = "git://10.66.82.200/autoit"
        dst_rsc_dir = "C:\"
        reboot = yes
        kill_vm_on_error = yes
        variants:
            - super_pi:
                test_name += "super_pi"
                autoit_entry= "C:\autoit\super_pi\run_super_pi.au3"
                autoit_binary= "cmd /c C:\AutoIt3\AutoIt3.exe"
                autoit_timeout= 900
                result_file= "C:\pi_rec.txt"
                result_parser= "super_pi"
            - iozone:
                test_name += "iozone"
                autoit_entry = "C:\io_stress_bench.bat"
                autoit_binary= "cmd /c"
                autoit_timeout= 5400
                result_file= "C:\iozone_result.txt"
                result_parser= "iozone"
            - linpack:
                test_name += "linpack"
                autoit_entry = "C:\run_linpack.au3"
                autoit_binary= "cmd /c C:\AutoIt3\AutoIt3.exe"
                autoit_timeout= 900
                result_file= "C:\linpack_result.txt"
                result_parser= "linpack"


# Device

# Device::Storage
variants:
    # Physical Based
    #- @pb:
    #    image_vbd = phy
    #    variants:
    #        - partition:
    #        - lvm:
    # File Based
    - @fb: 
        image_vbd = file_based
        # Image Format
        variants:
            - raw:
                image_format = raw
            - qcow:
                image_format = qcow
        variants:
            # loopback
            - loopback:
                vbd_type = loopback
            # blktap
            - blktap:
                vbd_type = blktap   

# Device::Network
variants:
    - ne2k_pci:
        nic_model = ne2k_pci
    - rtl8139:
        nic_model = rtl8139
    - pcnet:
        nic_model = pcnet
    - e1000:
        nic_model = e1000
    - @generic_nic:
        # for PV guests and HVM guest with PV drivers
variants:
    - netfront:
        nic_type = netfront
        no ne2k_pci rtl8139 pcnet e1000
        no pxeboot
    - ioemu:
        nic_type = ioemu
        no generic_nic

# Device::Display

# Device::Sound
variants:
    - es1370:
        soundhw = es1370
#   - sb16:
#       soundhw = sb16
    - @no_snd_card:
    # for Windows and PV guests
# Device::Serial


# Guests: { 'Linux' : { 'RHEL-Server-5.4', 'RHEL-4.8', 'RHEL-3.9'}, 'Windows' : { 'WinXP', 'Win2003', 'Win2008', 'WinVista', 'Win2008r2'}}

variants:
    - @Linux:
        shutdown_command = shutdown -h now
        reboot_command = shutdown -r now
        status_test_command = echo $?
        username = root
        password = redhat
        shell_client = ssh
        shell_port = 22
        file_transfer_client = scp
        file_transfer_port = 22
        mem_chk_cmd = free -m | grep Mem | awk {'print $2'}
        cpus_chk_cmd = grep -c processor /proc/cpuinfo
        eths_chk_cmd = ifconfig -a |grep ^eth |wc -l
        blocks_chk_cmd = test -b /dev/%s
        uptime_chk_cmd = cat /proc/uptime
        crash_trigger_cmd = echo c > /proc/sysrq-trigger
        shell_prompt = "^\[.*\][\#\$]\s*$"
        Time_Keeping:
            time_command = date +'TIME: %a %m/%d/%Y %H:%M:%S.%N'
            time_filter_re = "(?:TIME: \w\w\w )(.{19})(?:\.\d\d)"
            time_format = "%m/%d/%Y %H:%M:%S"
            guest_load_command = "dd if=/dev/zero of=/dev/null"
            guest_load_instances = 2
            guest_load_clean_cmd = "killall -9 dd"
            host_load_command = "bzip2 -c --best /dev/urandom > /dev/null"
            host_load_instances = 8
        audio_test:
            random_content_size = 10k
            audio_test_cmd = test -c /dev/dsp && dd if=/dev/urandom of=/dev/dsp bs=%s count=1

        variants:
            - RHEL-Server-6.1:
                guest_name = RHEL-Server-6.1
                variants:
                     - i386:
                        variants:
                            - @pv:
                                image_name = RHEL-Server-6.1-32-pv
                                pv_prescript:
                                    tree = "http://download.englab.nay.redhat.com/pub/rhel/rel-eng/latest-RHEL-6/6/Server/i386/os/"
                                    pv_kickstart = "rhel-server-6.1-32-pv_install.ks"
                                    kernel = "images/pxeboot/vmlinuz"
                                    ramdisk = "images/pxeboot/initrd.img"

                            - @hvm:
                                no mem_set mem_max
                                no block_list
                                no network_list network_attach network_detach
                                image_name = RHEL-Server-6.1-32-hvm
                                install:
                                    cdrom = ISO/RHEL-Server-6.1/32/RHEL-Server-6.1-i386-latest.iso
                                    unattended_files = "RHEL-Server-6.1-32-minimal-ks.cfg"
                                    fda = RHEL-Server-6.1-32-install.vfd
                                    dev_cdrom = hdc
                                    boot = cd
                                    image_dev = hda
                                    image_size = 8G
                                    vnclisten = 0.0.0.0
                                    install_timeout = 2400

                    - x86_64:
                        variants:
                            - @pv:
                                image_name = RHEL-Server-6.1-64-pv
                                pv_prescript:
                                    tree = "http://download.englab.nay.redhat.com/pub/rhel/rel-eng/latest-RHEL-6/6/Server/x86_64/os/"
                                    pv_kickstart = "rhel-server-6.1-64-pv_install.ks"
                                    kernel = "images/pxeboot/vmlinuz"
                                    ramdisk = "images/pxeboot/initrd.img"
                            - @hvm:
                                no mem_set mem_max
                                no block_list
                                no network_list network_attach network_detach
                                image_name = RHEL-Server-6.1-64-hvm
                                install:
                                    cdrom = ISO/RHEL-Server-6.1/64/RHEL-Server-6.1-x86_64-latest.iso
                                    unattended_files = "RHEL-Server-6.1-64-minimal-ks.cfg"
                                    fda = RHEL-Server-6.1-64-install.vfd
                                    dev_cdrom = hdc
                                    boot = cd
                                    image_dev = hda
                                    image_size = 8G
                                    vnclisten = 0.0.0.0
                                    install_timeout = 2400

            - RHEL-Server-6.0:
                guest_name = RHEL-Server-6.0
                variants:
                     - i386:
                        variants:
                            - @pv:
                                image_name = RHEL-Server-6.0-32-pv
                                pv_prescript:
                                    #tree = "http://download.englab.nay.redhat.com/pub/rhel/released/RHEL-6/Beta-2/Server/i386/os/"
                                    tree = "http://download.englab.nay.redhat.com/pub/rhel/released/RHEL-6/6.0/Server/i386/os/"
                                    #tree = http://10.66.92.96/tree/RHEL6.0/i386/
                                    pv_kickstart = "rhel-server-6.0-32-pv_install.ks"
                                    kernel = "images/pxeboot/vmlinuz"
                                    ramdisk = "images/pxeboot/initrd.img"

                            - @hvm:
                                no mem_set mem_max
                                no block_list
                                no network_list network_attach network_detach
                                image_name = RHEL-Server-6.0-32-hvm
                                install:
                                    cdrom = ISO/RHEL-Server-6.0/32/RHEL-Server-6.0-i386-latest.iso
                                    unattended_files = "RHEL-Server-6.0-32-minimal-ks.cfg"
                                    fda = RHEL-Server-6.0-32-install.vfd
                                    dev_cdrom = hdc
                                    boot = cd
                                    image_dev = hda
                                    image_size = 8G
                                    vnclisten = 0.0.0.0
                                    install_timeout = 2400

                    - x86_64:
                        variants:
                            - @pv:
                                image_name = RHEL-Server-6.0-64-pv
                                pv_prescript:
                                    #tree = "http://download.englab.nay.redhat.com/pub/rhel/released/RHEL-6/Beta-2/Server/x86_64/os/"
                                    tree = "http://download.englab.nay.redhat.com/pub/rhel/released/RHEL-6/6.0/Server/x86_64/os/"
                                    #tree = http://10.66.92.96/tree/RHEL6.0/x86_64/
                                    pv_kickstart = "rhel-server-6.0-64-pv_install.ks"
                                    kernel = "images/pxeboot/vmlinuz"
                                    ramdisk = "images/pxeboot/initrd.img"
                            - @hvm:
                                no mem_set mem_max
                                no block_list
                                no network_list network_attach network_detach
                                image_name = RHEL-Server-6.0-64-hvm
                                install:
                                    cdrom = ISO/RHEL-Server-6.0/64/RHEL-Server-6.0-x86_64-latest.iso
                                    unattended_files = "RHEL-Server-6.0-64-minimal-ks.cfg"
                                    fda = RHEL-Server-6.0-64-install.vfd
                                    dev_cdrom = hdc
                                    boot = cd
                                    image_dev = hda
                                    image_size = 8G
                                    vnclisten = 0.0.0.0
                                    install_timeout = 2400

            - RHEL-Server-5.7:
                guest_name = RHEL-Server-5.7
                no guest_s4
                variants:
                     - i386:
                        variants:
                            - @pv:
                                image_name = RHEL-Server-5.7-32-pv
                                pv_prescript:
                                    tree = "http://download.englab.nay.redhat.com/pub/rhel/rel-eng/latest-RHEL-5-Server/5/i386/os/"
                                    pv_kickstart = "rhel-server-5.7-32-pv_install.ks"
                            - @hvm:
                                no network_list network_attach network_detach
                                image_name = RHEL-Server-5.7-32-hvm
                                install:
                                    cdrom = ISO/RHEL-Server-5.7/32/RHEL-Server-5.7-i386-latest.iso
                                    unattended_files = "RHEL-Server-5.7-32-minimal-ks.cfg"
                                    fda = RHEL-Server-5.7-32-install.vfd
                                    dev_cdrom = hdc
                                    boot = cd
                                    image_dev = hda
                                    image_size = 8G
                                    vnclisten = 0.0.0.0

                    - x86_64:
                        variants:
                            - @pv:
                                image_name = RHEL-Server-5.7-64-pv
                                pv_prescript:
                                    tree = "http://download.englab.nay.redhat.com/pub/rhel/rel-eng/latest-RHEL-5-Server/5/x86_64/os/"
                                    pv_kickstart = "rhel-server-5.7-64-pv_install.ks"
                            - @hvm:
                                no network_list network_attach network_detach
                                image_name = RHEL-Server-5.7-64-hvm
                                install:
                                    cdrom = ISO/RHEL-Server-5.7/64/RHEL-Server-5.7-x86_64-latest.iso
                                    unattended_files = "RHEL-Server-5.7-64-minimal-ks.cfg"
                                    fda = RHEL-Server-5.7-64-install.vfd
                                    dev_cdrom = hdc
                                    boot = cd
                                    image_dev = hda
                                    image_size = 8G
                                    vnclisten = 0.0.0.0

            - RHEL-Server-5.6:
                guest_name = RHEL-Server-5.6
                no guest_s4
                variants:
                     - i386:
                        variants:
                            - @pv:
                                image_name = RHEL-Server-5.6-32-pv
                                pv_prescript:
                                    tree = "http://download.englab.nay.redhat.com/pub/rhel/released/RHEL-5-Server/U6/i386/os/"
                                    pv_kickstart = "rhel-server-5.6-32-pv_install.ks"
                            - @hvm:
                                no network_list network_attach network_detach
                                image_name = RHEL-Server-5.6-32-hvm
                                install:
                                    cdrom = ISO/RHEL-Server-5.6/32/RHEL-Server-5.6-i386-latest.iso
                                    unattended_files = "RHEL-Server-5.6-32-minimal-ks.cfg"
                                    fda = RHEL-Server-5.6-32-install.vfd
                                    dev_cdrom = hdc
                                    boot = cd
                                    image_dev = hda
                                    image_size = 8G
                                    vnclisten = 0.0.0.0

                    - x86_64:
                        variants:
                            - @pv:
                                image_name = RHEL-Server-5.6-64-pv
                                pv_prescript:
                                    tree = "http://download.englab.nay.redhat.com/pub/rhel/released/RHEL-5-Server/U6/x86_64/os/"
                                    pv_kickstart = "rhel-server-5.6-64-pv_install.ks"
                            - @hvm:
                                no network_list network_attach network_detach
                                image_name = RHEL-Server-5.6-64-hvm
                                install:
                                    cdrom = ISO/RHEL-Server-5.6/64/RHEL-Server-5.6-x86_64-latest.iso
                                    unattended_files = "RHEL-Server-5.6-64-minimal-ks.cfg"
                                    fda = RHEL-Server-5.6-64-install.vfd
                                    dev_cdrom = hdc
                                    boot = cd
                                    image_dev = hda
                                    image_size = 8G
                                    vnclisten = 0.0.0.0

            - RHEL-Server-5.5:
                guest_name = RHEL-Server-5.5
                no guest_s4
                variants:
                     - i386:
                        variants:
                            - @pv:
                                image_name = RHEL-Server-5.5-32-pv
                                pv_prescript:
                                    #tree = "http://download.englab.nay.redhat.com/pub/rhel/rel-eng/latest-RHEL-5-Server/tree-i386/"
                                    tree = "http://download.englab.nay.redhat.com/pub/rhel/released/RHEL-5-Server/U5/i386/os/"
                                    pv_kickstart = "rhel-server-5.5-32-pv_install.ks"
                            - @hvm:
                                no network_list network_attach network_detach
                                image_name = RHEL-Server-5.5-32-hvm
                                install:
                                    cdrom = ISO/RHEL-Server-5.5/32/RHEL-Server-5.5-i386-latest.iso
                                    unattended_files = "RHEL-Server-5.5-32-minimal-ks.cfg"
                                    fda = RHEL-Server-5.5-32-install.vfd
                                    dev_cdrom = hdc
                                    boot = cd
                                    image_dev = hda
                                    image_size = 8G
                                    vnclisten = 0.0.0.0

                    - x86_64:
                        variants:
                            - @pv:
                                image_name = RHEL-Server-5.5-64-pv
                                pv_prescript:
                                    #tree = "http://download.englab.nay.redhat.com/pub/rhel/rel-eng/latest-RHEL-5-Server/tree-x86_64/"
                                    tree = "http://download.englab.nay.redhat.com/pub/rhel/released/RHEL-5-Server/U5/x86_64/os/"
                                    pv_kickstart = "rhel-server-5.5-64-pv_install.ks"
                            - @hvm:
                                no network_list network_attach network_detach
                                image_name = RHEL-Server-5.5-64-hvm
                                install:
                                    cdrom = ISO/RHEL-Server-5.5/64/RHEL-Server-5.5-x86_64-latest.iso
                                    unattended_files = "RHEL-Server-5.5-64-minimal-ks.cfg"
                                    fda = RHEL-Server-5.5-64-install.vfd
                                    dev_cdrom = hdc
                                    boot = cd
                                    image_dev = hda
                                    image_size = 8G
                                    vnclisten = 0.0.0.0

            - RHEL-Server-5.4:
                guest_name = RHEL-Server-5.4
                no guest_s4
                variants:
                     - i386:
                        variants:
                            - @pv:
                                image_name = RHEL-Server-5.4-32-pv
                                pv_prescript:
                                    tree = "http://download.englab.nay.redhat.com/pub/rhel/released/RHEL-5-Server/U4/i386/os/"
                                    pv_kickstart = "rhel-server-5.4-32-pv_install.ks"
                            - @hvm:
                                image_name = RHEL-Server-5.4-32-hvm
                                install:
                                    cdrom = ISO/RHEL-Server-5.4/32/rhel5u4x32_floppyInstall.iso
                                    unattended_files = "RHEL-Server-5.4-32-minimal-ks.cfg"
                                    fda = RHEL-Server-5.4-32-install.vfd
                                    dev_cdrom = hdc
                                    boot = cd
                                    image_dev = hda
                                    image_size = 8G
                                    vnclisten = 0.0.0.0

                    - x86_64:
                        variants:
                            - @pv:
                                image_name = RHEL-Server-5.4-64-pv
                                pv_prescript:
                                    tree = "http://download.englab.nay.redhat.com/pub/rhel/released/RHEL-5-Server/U4/x86_64/os/"
                                    pv_kickstart = "rhel-server-5.4-64-pv_install.ks"
                            - @hvm:
                                image_name = RHEL-Server-5.4-64-hvm
                                install:
                                    cdrom = ISO/RHEL-Server-5.4/64/rhel5u4x64_floppyInstall.iso
                                    unattended_files = "RHEL-Server-5.4-64-minimal-ks.cfg"
                                    fda = RHEL-Server-5.4-64-install.vfd
                                    dev_cdrom = hdc
                                    boot = cd
                                    image_dev = hda
                                    image_size = 8G
                                    vnclisten = 0.0.0.0

            - RHEL-4.9:
                guest_name = RHEL-4.9
                no guest_s4
                variants:
                    - i386:
                        variants:
                            - @pv:
                                image_name = RHEL-4.9-32-pv
                                pv_prescript:
                                    tree = "http://download.englab.nay.redhat.com/pub/rhel/released/RHEL-4/U9/AS/i386/tree/"
                                    pv_kickstart = "rhel-4.9-32-pv_install.ks"
                            - @hvm:
                                no mem_set mem_max
                                no block_list block_attach block_detach
                                no network_list network_attach network_detach
                                image_name = RHEL-4.9-32-hvm
                                install:
                                    cdrom = ISO/RHEL-4.9/32/RHEL-4.9-32-latest.iso
                                    unattended_files = "RHEL-4.9-32-minimal-ks.cfg"
                                    fda = RHEL-4.9-32-install.vfd
                                    dev_cdrom = hdc
                                    boot = cd
                                    image_dev = hda
                                    image_size = 8G
                                    vnclisten = 0.0.0.0

                    - x86_64:
                        variants:
                            - @pv:
                                image_name = RHEL-4.9-64-pv
                                pv_prescript:
                                    tree = "http://download.englab.nay.redhat.com/pub/rhel/released/RHEL-4/U9/AS/x86_64/tree/"
                                    pv_kickstart = "rhel-4.9-64-pv_install.ks"
                            - @hvm:
                                no mem_set mem_max
                                no block_list block_attach block_detach
                                no network_list network_attach network_detach
                                image_name = RHEL-4.9-64-hvm
                                install:
                                    cdrom = ISO/RHEL-4.9/64/RHEL-4.9-64-latest.iso
                                    unattended_files = "RHEL-4.9-64-minimal-ks.cfg"
                                    fda = RHEL-4.9-64-install.vfd
                                    dev_cdrom = hdc
                                    boot = cd
                                    image_dev = hda
                                    image_size = 8G
                                    vnclisten = 0.0.0.0

            - RHEL-4.8:
                guest_name = RHEL-4.8
                no guest_s4
                variants:
                    - i386:
                        variants:
                            - @pv:
                                image_name = RHEL-4.8-32-pv
                                pv_prescript:
                                    #tree = "http://download.englab.nay.redhat.com/pub/rhel/rel-eng/RHEL4-U8-re20090504.0/tree-AS-i386/"
                                    tree = "http://download.englab.nay.redhat.com/pub/rhel/released/RHEL-4/U8/AS/i386/tree/"
                                    pv_kickstart = "rhel-4.8-32-pv_install.ks"
                            - @hvm:
                                no mem_set mem_max
                                no block_list block_attach block_detach
                                no network_list network_attach network_detach
                                image_name = RHEL-4.8-32-hvm
                                install:
                                    cdrom = ISO/RHEL-4.8/32/rhel4u8x32_floppyInstall.iso
                                    unattended_files = "RHEL-4.8-32-minimal-ks.cfg"
                                    fda = RHEL-4.8-32-install.vfd
                                    dev_cdrom = hdc
                                    boot = cd
                                    image_dev = hda
                                    image_size = 8G
                                    vnclisten = 0.0.0.0

                    - x86_64:
                        variants:
                            - @pv:
                                image_name = RHEL-4.8-64-pv
                                pv_prescript:
                                    #tree = "http://download.englab.nay.redhat.com/pub/rhel/rel-eng/RHEL4-U8-re20090504.0/tree-AS-x86_64/"
                                    tree = "http://download.englab.nay.redhat.com/pub/rhel/released/RHEL-4/U8/AS/x86_64/tree/"
                                    pv_kickstart = "rhel-4.8-64-pv_install.ks"
                            - @hvm:
                                no mem_set mem_max
                                no block_list block_attach block_detach
                                no network_list network_attach network_detach
                                image_name = RHEL-4.8-64-hvm
                                install:
                                    cdrom = ISO/RHEL-4.8/64/rhel4u8x64_floppyInstall.iso
                                    unattended_files = "RHEL-4.8-64-minimal-ks.cfg"
                                    fda = RHEL-4.8-64-install.vfd
                                    dev_cdrom = hdc
                                    boot = cd
                                    image_dev = hda
                                    image_size = 8G
                                    vnclisten = 0.0.0.0

            - RHEL-3.9:
                no dump_core_automatically
                no xm_sysrq
                no mem_set mem_max
                no block_list block_attach block_detach
                no network_list network_attach network_detach
                no guest_s4
                guest_name = RHEL-3.9
                variants:
                    - i386:
                        variants:
                            - @hvm:
                                image_name = RHEL-3.9-32-hvm
                                install:
                                    cdrom = ISO/RHEL-3.9/32/rhel3u9x32_floppyInstall.iso
                                    unattended_files = "RHEL-3.9-32-minimal-ks.cfg"
                                    fda = RHEL-3.9-32-install.vfd
                                    dev_cdrom = hdc
                                    boot = cd
                                    image_dev = hda
                                    image_size = 8G
                                    vnclisten = 0.0.0.0

                    - x86_64:
                        variants:
                            - @hvm:
                                image_name = RHEL-3.9-64-hvm
                                install:
                                    cdrom = ISO/RHEL-3.9/64/rhel3u9x64_floppyInstall.iso
                                    unattended_files = "RHEL-3.9-64-minimal-ks.cfg"
                                    fda = RHEL-3.9-64-install.vfd
                                    dev_cdrom = hdc
                                    boot = cd
                                    image_dev = hda
                                    image_size = 8G
                                    vnclisten = 0.0.0.0

    - @Windows:
        migration_test_command = dir
        device_model = "/usr/lib64/xen/bin/qemu-dm"
        kernel = "/usr/lib/xen/boot/hvmloader"
        shutdown_command = shutdown /s /t 0
        reboot_command = shutdown /r /t 0
        status_test_command = echo %errorlevel%
        shell_prompt = "^\w:\\.*>\s*$"
        username = Administrator
        password = redhat
        shell_linesep = "\r\n"
        shell_client = nc
        shell_port = 22
        cpus_chk_cmd = echo %NUMBER_OF_PROCESSORS%
        uptime_chk_cmd = uptime.exe
        mem_chk_cmd = wmic MemPhysical get MaxCapacity | findstr /r "^[0-9][0-9]*" >tmp && set /p memsize= <tmp && set /a memsize/1024
        install_timeout = 4500
        Time_Keeping:
            time_command = "echo TIME: %date% %time%"
            time_filter_re = "(?<=TIME: \w\w\w ).{19}(?=\.\d\d)"
            time_format = "%m/%d/%Y %H:%M:%S"
            guest_load_command = "C:\cpu_stress.bat"
            guest_load_instances = 1
            guest_load_clean_cmd = "C:\kill_cpu_stress.bat"
            host_load_command = "bzip2 -c --best /dev/urandom > /dev/null"
            host_load_instances = 8


        variants:
            - WinXP:
                guest_name = WinXP
                variants:
                    - i386:
                        variants:
                            - @hvm:
                                image_name = WinXP-32-hvm
                                install:
                                    cdrom = ISO/WinXP/32/WindowsXP-32.iso
                                    unattended_files = "WinXP-32.sif, setup.vbs, rss.exe"
                                    fda = WinXP-32-install.vfd
                                    dev_cdrom = hdc
                                    boot = dc
                                    image_dev = hda
                                    image_size = 10G
                                    vnclisten = 0.0.0.0

            - Win2003:
                guest_name = Win2003
                variants:
                    - i386:
                        variants:
                            - @hvm:
                                image_name = Win2003-32-hvm
                                install:
                                    cdrom = ISO/Win2003/32/Windows2003-32.iso
                                    unattended_files = "Win2003-32.sif, setup.vbs, rss.exe"
                                    fda = Win2003-32-install.vfd
                                    dev_cdrom = hdc
                                    boot = dc
                                    image_dev = hda
                                    image_size = 10G
                                    vnclisten = 0.0.0.0
                                    cmd_shutdown = shutdown /s /f /t 0
                                    reboot_command = shutdown /r /f /t 0

                    - x86_64:
                        variants:
                            - @hvm:
                                image_name = Win2003-64-hvm
                                #can not shutdown via nc, windows 2k3 64bit issue,using xm shutdown instead
                                reboot_method = xm_reboot
                                install:
                                    cdrom = ISO/Win2003/64/Windows2003-64.iso
                                    unattended_files = "Win2003-64.sif, setup.vbs, rss.exe"
                                    fda = Win2003-32-install.vfd
                                    dev_cdrom = hdc
                                    boot = dc
                                    image_dev = hda
                                    image_size = 10G
                                    vnclisten = 0.0.0.0

            - WinVista:
                guest_name = WinVista
                variants:
                    - i386:
                        variants:
                            - @hvm:
                                image_name = WinVista-32-hvm
                                install:
                                    cdrom = ISO/WinVista/32/en_windows_vista_enterprise_with_service_pack_1_x86_dvd_x14-55954.iso
                                    unattended_files = "WinVista-32-autounattend.xml, rss.exe"
                                    fda = WinVista-32-install.vfd
                                    dev_cdrom = hdc
                                    boot = dc
                                    image_dev = hda
                                    image_size = 15G
                                    vnclisten = 0.0.0.0

                    - x86_64:
                        variants:
                            - @hvm:
                                image_name = WinVista-64-hvm
                                install:
                                    cdrom = ISO/WinVista/64/en_windows_vista_enterprise_with_service_pack_1_x64_dvd_x14-55934.iso
                                    unattended_files = "WinVista-64-autounattend.xml, rss.exe"
                                    fda = WinVista-64-install.vfd
                                    dev_cdrom = hdc
                                    boot = dc
                                    image_dev = hda
                                    image_size = 15G
                                    vnclisten = 0.0.0.0

            - Win2008:
                guest_name = Win2008
                variants:
                    - i386:
                        variants:
                            - @hvm:
                                image_name = Win2008-32-hvm
                                install:
                                    cdrom = ISO/Win2008/32/Windows2008-x86.iso
                                    unattended_files = "Win2008-32-autounattend.xml, rss.exe"
                                    fda = Win2008-32-install.vfd
                                    dev_cdrom = hdc
                                    boot = dc
                                    image_dev = hda
                                    image_size = 15G
                                    vnclisten = 0.0.0.0
                                    cmd_shutdown = shutdown /s /f /t 0
                                    reboot_command = shutdown /r /f /t 0

                    - x86_64:
                        variants:
                            - @hvm:
                                image_name = Win2008-64-hvm
                                install:
                                    cdrom = ISO/Win2008/64/Windows2008-x64.iso
                                    unattended_files = "Win2008-64-autounattend.xml, rss.exe"
                                    fda = Win2008-64-install.vfd
                                    dev_cdrom = hdc
                                    boot = dc
                                    image_dev = hda
                                    image_size = 15G
                                    vnclisten = 0.0.0.0
                                    cmd_shutdown = shutdown /s /f /t 0
                                    reboot_command = shutdown /r /f /t 0

            - Win2008r2:
                guest_name = Win2008r2
                variants:
                    - x86_64:
                        variants:
                            - @hvm:
                                image_name = Win2008r2-64-hvm
                                install:
                                    cdrom = ISO/Win2008r2/64/Windows_Server_2008_R2_RC_EN.iso
                                    unattended_files = "Win2008r2-64-autounattend.xml, rss.exe"
                                    fda = Win2008r2-64-install.vfd
                                    dev_cdrom = hdc
                                    boot = dc
                                    image_dev = hda
                                    image_size = 15G
                                    vnclisten = 0.0.0.0
                                    cmd_shutdown = shutdown /s /f /t 0
                                    reboot_command = shutdown /r /f /t 0

            - Win7:
                guest_name = Win7
                variants:
                    - i386:
                        variants:
                            - @hvm:
                                image_name = Win7-32-hvm
                                install:
                                    cdrom = ISO/Win7/32/en_windows_7_ultimate_x86_dvd_x15-65921.iso
                                    unattended_files = "Win7-32-autounattend.xml, rss.exe"
                                    fda = Win7-32-install.vfd
                                    dev_cdrom = hdc
                                    boot = dc
                                    image_dev = hda
                                    image_size = 15G
                                    vnclisten = 0.0.0.0
                                    cmd_shutdown = shutdown /s /f /t 0
                                    reboot_command = shutdown /r /f /t 0

                    - x86_64:
                        variants:
                            - @hvm:
                                image_name = Win7-64-hvm
                                install:
                                    cdrom = ISO/Win7/64/en_windows_7_ultimate_x64_dvd_x15-65922.iso
                                    unattended_files = "Win7-64-autounattend.xml, rss.exe"
                                    fda = Win7-64-install.vfd
                                    dev_cdrom = hdc
                                    boot = dc
                                    image_dev = hda
                                    image_size = 15G
                                    vnclisten = 0.0.0.0
                                    cmd_shutdown = shutdown /s /f /t 0
                                    reboot_command = shutdown /r /f /t 0

variants:
    - PV:
        virt_type = PV
        no hvm
        only blktap
        only raw
        no ioemu
        only generic_nic
        only no_snd_card
        no audio_test
        no block_configure
        no hvmloader
        no acpi_check_on acpi_check_off
        no guest_s4
        # FIXME
        # pygrub is used in install but not pv_prescript
        bootloader = "/usr/bin/pygrub"
        vm_type = pv
        pv_prescript:
            bootloader =
        install:
            no Windows
            # bootloader should not be present when installing a pv guest
            type = pv_unattended_install
            post_command = "python scripts/pv_postinstall.py"
            post_command_noncritical = yes
            Installation = net

    - HVM:
        virt_type = HVM
        no pv
        no vcpu_set
        no Xendomains
        no pv_prescript
        image_dev = "hda"
        builder = "hvm"
        kernel = "/usr/lib/xen/boot/hvmloader"
        device_model = "%path_of_qemu-dm%"
        vnc = 1
        sdl = 0
        vncunused = 1
        vnclisten = 0.0.0.0
        only loopback
        install:
            type = hvm_unattended_install
            prefix_cdrom = file
            boot = cd
            pre_command = "python scripts/unattended.py; python scripts/check_iso.py"
            pre_command_noncritical = "no"
            Installation = cdrom
        Linux:
            vm_type = hvm_linux
            no no_snd_card
            no autoit
        Windows:
            vm_type = hvm_win
            only no_snd_card
            no audio_test
            no autotest
            no dump_core_automatically
            no xm_sysrq
            no mem_set mem_max
            no block_list block_attach block_detach
            no network_list network_attach network_detach
            no hvmloader
            no acpi_check_on acpi_check_off
            no guest_s4

i386:
    guest_arch = i386
x86_64:
    guest_arch = x86_64
ia64:
    guest_arch = ia64

# Host type: [x86host, x64host, ia64host]

variants:
    - @x86host:
        only i386
        HVM:
            device_model ?= "/usr/lib/xen/bin/qemu-dm"
    - @x64host:
        HVM:
            device_model ?= "/usr/lib64/xen/bin/qemu-dm"
    - @ia64host:
        only ia64
        HVM:
            device_model ?= "/usr/lib64/xen/bin/qemu-dm"

# case-specific restrictions
Qcow:
    # finetune and overrides for the Qcow cases
    img2qcow:
        only raw
    qcow2raw:
        only raw
    format_probe:
        only qcow
        only loopback
    format_set:
        only qcow
        vbd_type = blktap
    format_guess:
        only hvm
        probe_off:
            file:
                raw:
                    type = boot
                qcow:
                    type = boot_fail
            tap_aio:
                raw:
                    type = boot
                qcow:
                    type = boot_fail
            tap_qcow:
                raw:
                    type = boot_fail
                qcow:
                    type = boot
        probe_on:
            file:
                raw:
                    type = boot
                qcow:
                    type = boot
            tap_aio:
                raw:
                    type = boot
                qcow:
                    type = boot_fail
            tap_qcow:
                raw:
                    type = boot_fail
                qcow:
                    type = boot

check_smbios:
    only RHEL-Server-5.5 RHEL-Server-6.0

check_cpuflags:
    only RHEL-Server-5.5 RHEL-Server-6.0

x64host:
    HVM:
        i386:
            no mem_set mem_max

variants:
    - @PV_INSTALL:
        only PV
        only pv_prescript install
    - @HVM_INSTALL:
        only HVM
        only install
    - @ACCEPTANCE:
        only shutdown_all image_copy mem_set block_attach block_detach xm_destroy xm_domid xm_domname pause_vm unpause_vm reboot xm_rename xm_shutdown dump_core_manually migration ping_pong_migration save_vm restore_vm Network_Device_Model mem_max format_probe VCPU_Management pv_prescript install
    - @FUNCTIONAL:
        only shutdown_all image_copy boot reboot pause_vm unpause_vm xm_info xm_dmesg xm_log xm_list xm_help xm_rename timedrift_with_load timedrift_with_reboot migration save_vm restore_vm xm_uptime restart_xend sched_credit VCPU_Management Balloon Network_Device_Model PV_Drivers Guest_Dump_Core Xendomains xm_shutdown xm_destroy xm_domid xm_domname shutdown_options pxeboot check_smbios check_cpuflags Power_Management 
    - @PERFORMANCE:
        only shutdown_all image_copy autotest autoit
    - @MIGRATION:
        only shutdown_all image_copy migration ping_pong_migration
    - @TEST:
        # Add you test here when debug it for Xen-Autotest
        # Also enable TEST at the bottom of this file.
        # Disable TEST and delete your test here after debuging
        only boot

image_name.* ?<= images/
cdrom.* ?<= isos/
fda.* ?<= floppies/

important_key = virt_type, guest_name, guest_arch, vcpus, memory, vbd_type, image_format, nic_model, xen_version, kernel_version, Installation, tcms_id

no RHEL-Server-5.4
no RHEL-Server-5.5
no RHEL-4.8
no RHEL-3.9
no vcpu_boot_pin
no ne2k_pci pcnet

#only raw
#only pv_install hvm_install
#only pv_install
#only RHEL-Server-5.4.x86_64
#only ACCEPTANCE
#only RHEL-3.9 RHEL-4.8
#only PV
#only TEST
#only rtl8139
